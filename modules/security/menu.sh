#!/bin/bash
#   ( –†–û–î–ò–¢–ï–õ–¨ | –ö–õ–ê–í–ò–®–ê | –ù–ê–ó–í–ê–ù–ò–ï | –§–£–ù–ö–¶–ò–Ø | –ü–û–†–Ø–î–û–ö | –ì–†–£–ü–ü–ê | –û–ü–ò–°–ê–ù–ò–ï )
# menu.sh - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –º–æ–¥—É–ª—è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
#
# @menu.manifest
# @item( main | 1 | üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ${C_GREEN}(Firewall, Fail2Ban –∏ –¥—Ä.)${C_RESET} | show_security_menu | 0 | 0 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. )
#

[[ "${BASH_SOURCE[0]}" == "${0}" ]] && exit 1

show_security_menu() {
    enable_graceful_ctrlc
    while true; do
        clear
        menu_header "üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"
        printf_description "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞."
        echo ""

        # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –º–æ–¥—É–ª–µ–π
        render_menu_items "security"

        echo ""
        printf_menu_option "b" "–ù–∞–∑–∞–¥"
        echo ""

        local choice
        choice=$(safe_read "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ" "") || break

        if [[ "$choice" == "b" || "$choice" == "B" ]]; then
            break
        fi

        # –ò—â–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É–Ω–∫—Ç–∞—Ö
        local action
        action=$(get_menu_action "security" "$choice")
        
        if [[ -n "$action" ]]; then
            # –í—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç run_module)
            eval "$action"
            # –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤—ã–≤–æ–¥
            wait_for_enter 
        else
            warn "–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            sleep 1
        fi
    done
    disable_graceful_ctrlc
}